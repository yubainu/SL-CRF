# ONTOS Engine V12.3  
**Detecting Discontinuous Hallucinations via Structural Inconsistency**

When AI hallucinates, its structure breaks first.
ONTOS detects this â€” instantly, without reading a single word.
---

## Overview

**ONTOS (Structural Inconsistency Detection Engine)** is a multi-scale monitoring system designed to detect *structural discontinuities* in data streams.

Unlike conventional anomaly detectionâ€”which reacts to surface-level output changesâ€”ONTOS focuses on **logical topology**:  
it detects *when internal structure begins to break*, **before** observable failure occurs.

ONTOS computes a leading indicator called the **Inherent Discrepancy Index (IDI)**, which measures friction between multiple abstraction scales.

This repository demonstrates that **LLM-style hallucinations can be detected as structural events**, not semantic classification problems.

---

## Key Insight

> Hallucination is not an error in output.  
> It is a **collapse of cross-scale structural consistency**.

---

## Experimental Results

### 1. Numerical â€œGhost Driftâ€ Test

- Input signal remains statistically stable
- Baseline delta fails to detect anomalies
- **ONTOS IDI rises gradually**
- Structural erosion detected **5â€“10 steps before collapse**

**Conclusion:**  
ONTOS acts as a *leading indicator*, not a reactive alarm.

![Early Warning Performance](images/fig1.png)

---

### 2. Textual Hallucination Test

- Simulated semantic entropy stream
- Stable narrative â†’ logic drift â†’ discontinuous hallucination
- **IDI crosses threshold before semantic failure is explicit**

**Conclusion:**  
Logical leaps in text manifest as *structural discontinuities*, detectable without labels.

![Structural Breakdown Analysis](images/fig2.png)

---

## Technical Features

- **Multi-Scale Probing**  
  Polynomial Axioms (degree 1â€“5) monitor structure at different abstraction levels.

- **Topological Invariants**  
  Cross-scale consistency is tracked to expose â€œquiet contradictionsâ€ invisible to single-scale models.

- **Leading Indicator Design**  
  IDI reacts to *structural friction*, not magnitude or variance.

---



## Usage / How to Run

### Quick Start 
Follow these steps to verify the ONTOS structural monitoring on your local machine.

1 Clone the repository git clone https://github.com/yubainu/SL-CRF.git cd SL-CRF  
2 Run Numeric Anomaly Detection python demo_numeric.py  
3 Run Hallucination Detection python demo_text_hallucination.py  

### Technical Details: What happens in the demos?
#### 1. Numeric Anomaly Detection (demo_numeric.py)  
This demo simulates a data stream that transitions from a "stable state" to a "collapsing state."  
Phase 1 (Normal): Data fluctuates within a healthy range. IDI remains near 0.  
Phase 2 (Drift): Data begins to deviate. Even before the values become extreme, ONTOS detects "structural friction," and the IDI line spikes.  
Goal: To prove that ONTOS identifies the precursor to failure, not just the failure itself.

#### 2. Hallucination Detection (demo_text_hallucination.py)
This demo simulates an AI's internal metrics during text generation.  
Stable Text: Normal sentence structures produce low IDI.  
Hallucinated Text: When the AI generates nonsensical statements (e.g., "Apples taste like gravity"), the internal mapping breaks.  
Alert: ONTOS flags these specific steps as "Structural Discontinuity," allowing for real-time filtering of unreliable AI outputs.

### 1. Requirements
```
pip install numpy matplotlib
```

### 2. Basic Implementation (Python)
```
from ontos_stub import ONTOS
```

#### Input Data Specification
To ensure accurate structural analysis, the input to `monitor.step(value)` should be defined as follows:

* **Range**: Recommended `0.0` to `1.0` (Normalized values).
* **Data Type**: Float.
* **Contextual Mapping**:
    * **For LLMs**: Use token probabilities, log-probs, or semantic entropy.
    * **For Time-Series**: Use delta changes or normalized observation values.

*Note: ONTOS monitors the "friction" between scales, so providing a consistent stream of related data points is key for IDI accuracy.*

#### 1. Initialize
```
monitor = ONTOS(alert_threshold=0.25)
```

#### 2. Feed data and get result (IDI)
```
data_point = 0.18
result = monitor.step(data_point)
```

#### 3. Handle output
```python
print(f"Current IDI: {result['idi']}")  
if result['report']:  
    print(f"Alert: {result['report']}")
```

### 3. Run Demo Scripts
#### A. Numerical Ghost Drift Test
```
python demo_numeric.py
```

##### Expected behavior:

Baseline delta stays inconclusive.

ONTOS IDI increases smoothly.

Alert triggers before visible collapse.

##### Outputs:  
numeric_idi_test.png

#### B. Textual Hallucination Detection Test
```
python demo_text_hallucination.py
```

##### Expected behavior:

Structural erosion detected before hallucination.

IDI exceeds threshold prior to semantic breakdown.

##### Outputs:  
text_hallucination_test.png


### Understanding the Output

Each step() returns:

{  
    "idi": float,        # Global structural instability  
    "report": str,      # Diagnostic message (empty if stable)  
    "idi_map": dict     # Per-invariant IDI (abstracted)  
}

Interpretation:  
	â€¢	IDI < threshold â†’ structurally coherent  
	â€¢	IDI rising â†’ hidden erosion  
	â€¢	IDI > threshold â†’ discontinuity detected


### About the Public Stub

This repository exposes a behavior-preserving stub of ONTOS.

Guaranteed:  
	â€¢	Same public interface  
	â€¢	Comparable IDI dynamics  
	â€¢	Reproducible detection timing  

Intentionally hidden:  
	â€¢	Internal belief mechanics  
	â€¢	Structural memory rules  
	â€¢	Exact invariant topology  

Reproducibility without reversibility



### Reproducibility Statement

All results in this repository can be reproduced by running the provided scripts.

While the ONTOS core is not release,
the behavioral claims, timing, and detection characteristics are independently verifiable.

This repository is suitable for:  
	â€¢	Independent validation  
	â€¢	Safety research  
	â€¢	Alignment discussion  
	â€¢	Industrial feasibility review  

## Future Work
	â€¢	Dataset purification via structural filtering  
	â€¢	Training cost reduction by excluding high-belief samples  
	â€¢	Real-time detection of structural mislearning in LLM training loops  

## FAQ  
### Q: How does this differ from existing hallucination detection (e.g., semantic checking)?  
A: Conventional methods verify "semantics" (meaning), whereas ONTOS monitors "topology" (structure). By quantifying the Internal Dissonance (IDI) during the generation process, it identifies signs of collapse instantly without cross-referencing external databases or search engines.

### Q: How is it possible to detect errors "without reading a single word"?   
A: ONTOS does not analyze the text content itself. Instead, it processes the "warping" of internal probability distributions or attention weights as raw data. Similar to structural engineering, it predicts a collapse by measuring the deflection of a beam rather than looking at the color of the walls.

### Q: How should the IDI threshold be configured?   
A: It depends on the specific model and task. We recommend running demo_numeric.py to establish a baseline and setting the initial threshold at approximately +2Ïƒ (standard deviations) from the mean of normal operation.

### Q: Is the computational overhead high?  
A: It is extremely lightweight. Compared to the computational resources required by the Large Language Model (LLM) itself, the overhead for ONTOS structural analysis is negligible, making it ideal for real-time monitoring.

## Contact

For collaboration, licensing, or technical consultation:

ğŸ“§ [yubainu98@gmail.com]

---

**Interested in deploying ONTOS?**

We offer technical deep-dives.


# ONTOS Engine V12.3 ä¸é€£ç¶šãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹é€ æ¤œçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³

## æ¦‚è¦
ONTOSï¼ˆStructural Inconsistency Detection Engineï¼‰ã¯ã€
ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®èƒŒå¾Œã«ã‚ã‚‹è«–ç†æ§‹é€ ã®ä¸é€£ç¶šæ€§ã‚’æ¤œçŸ¥ã™ã‚‹å¤šé‡å°ºåº¦ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚

å¾“æ¥ã®ç•°å¸¸æ¤œçŸ¥ãŒã€Œçµæœã€ã«åå¿œã™ã‚‹ã®ã«å¯¾ã—ã€
ONTOSã¯æ§‹é€ ãŒå£Šã‚Œå§‹ã‚ãŸç¬é–“ã‚’æ‰ãˆã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

ãã®æŒ‡æ¨™ãŒ IDIï¼ˆInherent Discrepancy Indexï¼‰ ã§ã™ã€‚

## æ ¸å¿ƒçš„ãªè€ƒãˆæ–¹
ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Œé–“é•ã„ã€ã§ã¯ãªã„ã€‚
æŠ½è±¡åº¦é–“ã®æ•´åˆæ€§ãŒå´©å£Šã—ãŸæ§‹é€ ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚‹ã€‚

## å®Ÿé¨“çµæœ
### 1. æ•°å€¤çš„ã‚´ãƒ¼ã‚¹ãƒˆãƒ»ãƒ‰ãƒªãƒ•ãƒˆè©¦é¨“
â€¢å…¥åŠ›ã¯çµ±è¨ˆçš„ã«å®‰å®š  
â€¢ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã§ã¯ç•°å¸¸æ¤œçŸ¥ä¸å¯  
â€¢IDIãŒå…ˆè¡Œçš„ã«ä¸Šæ˜‡  
â€¢å´©å£Šã®5ã€œ10ã‚¹ãƒ†ãƒƒãƒ—å‰ã«æ¤œçŸ¥

### 2. è¨€èªçš„ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³è©¦é¨“
â€¢å®‰å®šæ–‡è„ˆ â†’ è«–ç†ãƒ‰ãƒªãƒ•ãƒˆ â†’ ä¸é€£ç¶šã‚¸ãƒ£ãƒ³ãƒ—  
â€¢æ„å‘³ç ´ç¶»ã®å‰ã«IDIãŒé–¾å€¤ã‚’çªç ´

## æŠ€è¡“çš„ç‰¹å¾´
â€¢å¤šé‡å°ºåº¦ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°  
 1æ¬¡ã€œ5æ¬¡ã®æ§‹é€ AxiomãŒåŒæ™‚ç›£è¦–  
â€¢ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ãƒ»ã‚¤ãƒ³ãƒãƒªã‚¢ãƒ³ãƒˆ  
 å°ºåº¦é–“ã®çŸ›ç›¾ã‚’ç›´æ¥æ¤œçŸ¥  
â€¢å…ˆè¡ŒæŒ‡æ¨™è¨­è¨ˆ  
 çµ±è¨ˆé‡ã§ã¯ãªãæ§‹é€ æ‘©æ“¦ã«åå¿œ

## ä½¿ã„æ–¹

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ
ä»¥ä¸‹ã®æ‰‹é †ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ã¦ONTOSã®æ§‹é€ ç›£è¦–ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚
1 ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ git clone https://github.com/yubainu/SL-CRF.git cd SL-CRF  
2 æ•°å€¤ç•°å¸¸æ¤œçŸ¥ã®å®Ÿè¡Œ python demo_numeric.py  
3 ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¤œçŸ¥ã®å®Ÿè¡Œ python demo_text_hallucination.py  

### å„ãƒ‡ãƒ¢ã®è©³ç´°è§£èª¬  
#### 1. æ•°å€¤ç•°å¸¸æ¤œçŸ¥ (demo_numeric.py)
ã€Œå®‰å®šã—ãŸçŠ¶æ…‹ã€ã‹ã‚‰ã€Œå´©å£Šã—ã¦ã„ãçŠ¶æ…‹ã€ã¸ã®æ¨ç§»ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚  
æ­£å¸¸ãƒ•ã‚§ãƒ¼ã‚º: ãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸ç¯„å›²å†…ã§æ¨ç§»ã—ã€IDIï¼ˆä¸å”å’ŒæŒ‡æ•°ï¼‰ã¯0ä»˜è¿‘ã§å®‰å®šã—ã¾ã™ã€‚  
å´©å£Šãƒ•ã‚§ãƒ¼ã‚º: ãƒ‡ãƒ¼ã‚¿ãŒæ¼‚æµï¼ˆãƒ‰ãƒªãƒ•ãƒˆï¼‰ã‚’å§‹ã‚ã‚‹ã¨ã€æ•°å€¤ãŒæ¥µç«¯ãªå€¤ã«ãªã‚‹å‰ã«ã€ONTOSãŒã€Œæ§‹é€ çš„ãªæ‘©æ“¦ã€ã‚’æ¤œçŸ¥ã—ã€èµ¤è‰²ã®IDIãƒ©ã‚¤ãƒ³ãŒæ€¥ä¸Šæ˜‡ã—ã¾ã™ã€‚  
ç›®çš„: ç•°å¸¸ãŒèµ·ãã¦ã‹ã‚‰ã§ã¯ãªãã€ç•°å¸¸ã«è‡³ã‚‹ã€Œäºˆå…†ã€ã‚’æ‰ãˆã‚‰ã‚Œã‚‹ã“ã¨ã‚’è¨¼æ˜ã—ã¾ã™ã€‚
    
#### 2. ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¤œçŸ¥ (demo_text_hallucination.py)
ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆä¸­ã®AIå†…éƒ¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚  
æ­£å¸¸ãªãƒ†ã‚­ã‚¹ãƒˆ: æ•´åˆæ€§ã®å–ã‚ŒãŸæ–‡ç« ã§ã¯ã€IDIã¯ä½ãæŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚  
ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³: AIãŒã€Œãƒªãƒ³ã‚´ã¯é‡åŠ›ã®å‘³ãŒã™ã‚‹ã€ã¨ã„ã£ãŸæ”¯é›¢æ»…è£‚ãªå†…å®¹ã‚’ç”Ÿæˆã—ãŸç¬é–“ã€å†…éƒ¨æ§‹é€ ã®æ•´åˆæ€§ãŒç ´ç¶»ã—ã¾ã™ã€‚  
ã‚¢ãƒ©ãƒ¼ãƒˆ: ONTOSã¯ãã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã€Œæ§‹é€ çš„ä¸é€£ç¶šæ€§ã€ã¨ã—ã¦ç‰¹å®šã—ã€ä¿¡é ¼æ€§ã®ä½ã„å‡ºåŠ›ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é®æ–­ã§ãã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

### å¿…è¦ç’°å¢ƒ
â€¢Python 3.9+  
â€¢NumPy  
â€¢Matplotlib  

```bash
pip install numpy matplotlib
```

### æ•°å€¤ãƒ†ã‚¹ãƒˆ

```bash
python demo_numeric.py
```


### ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¤œè¨¼

```bash
python demo_text_hallucination.py
```


### å…¬é–‹ã‚¹ã‚¿ãƒ–ã«ã¤ã„ã¦

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ å†ç¾å¯èƒ½ãªã‚¹ã‚¿ãƒ–å®Ÿè£… ã‚’æä¾›ã—ã¾ã™ã€‚
â€¢æŒ¯ã‚‹èˆã„ã¯å†ç¾å¯èƒ½
â€¢å†…éƒ¨æ§‹é€ ã¯éå…¬é–‹
â€¢è§£æè€æ€§ã‚’ä¿æŒ

å†ç¾æ€§ã¯ã‚ã‚‹ãŒã€é€†è§£æã¯ã§ããªã„è¨­è¨ˆã§ã™ã€‚

### å†ç¾æ€§ã«ã¤ã„ã¦
æœ¬ãƒªãƒã‚¸ãƒˆãƒªã®å…¨ã¦ã®ä¸»å¼µã¯
ä»˜å±ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«ã‚ˆã‚Šæ¤œè¨¼å¯èƒ½ã§ã™ã€‚

### ä»Šå¾Œã®å±•æœ›  
â€¢å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ çš„æµ„åŒ–  
â€¢å†å­¦ç¿’ã‚³ã‚¹ãƒˆã®å‰Šæ¸›  
â€¢LLMå­¦ç¿’ä¸­ã®èª¤å­¦ç¿’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œçŸ¥  

### FAQ
#### Q: æ—¢å­˜ã®ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³æ¤œçŸ¥ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ»ãƒã‚§ãƒƒã‚¯ç­‰ï¼‰ã¨ä½•ãŒé•ã†ã®ã‹ï¼Ÿ  
A: å¾“æ¥ã®æ¤œçŸ¥ã¯ã€Œæ„å‘³ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼‰ã€ã‚’æ¤œè¨¼ã—ã¾ã™ãŒã€ONTOSã¯ã€Œæ§‹é€ ï¼ˆãƒˆãƒãƒ­ã‚¸ãƒ¼ï¼‰ã€ã‚’ç›£è¦–ã—ã¾ã™ã€‚AIãŒè¨€è‘‰ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸å”å’ŒéŸ³ï¼ˆInternal Dissonanceï¼‰ã‚’æ•°å€¤åŒ–ã™ã‚‹ãŸã‚ã€è¾æ›¸ã‚„æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å‚ç…§ã™ã‚‹ã“ã¨ãªãã€ç”Ÿæˆä¸­ã®ã€Œå…†å€™ã€ã‚’å³åº§ã«ç‰¹å®šã§ãã¾ã™ã€‚

#### Q: ãªãœã€Œè¨€è‘‰ã‚’ä¸€åˆ‡èª­ã¾ãšã«ã€æ¤œçŸ¥ã§ãã‚‹ã®ã‹ï¼Ÿ  
A: ONTOSã¯ãƒ†ã‚­ã‚¹ãƒˆã®å†…å®¹ãã®ã‚‚ã®ã§ã¯ãªãã€ãƒ¢ãƒ‡ãƒ«ã®å†…éƒ¨ã§è¨ˆç®—ã•ã‚Œã‚‹ç¢ºç‡åˆ†å¸ƒã‚„æ³¨æ„ï¼ˆAttentionï¼‰ã®é‡ã¿ã®ã€Œæ­ªã¿ã€ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚‹ã‹ã‚‰ã§ã™ã€‚å®¶ã®æ§‹é€ è¨ˆç®—ã¨åŒã˜ã§ã€å£ã®è‰²ã‚’è¦‹ã‚‹ã®ã§ã¯ãªãã€æ¢ã®ãŸã‚ã¿ã‚’è¦‹ã¦å´©å£Šã‚’äºˆè¦‹ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚

#### Q: IDIï¼ˆä¸å”å’ŒæŒ‡æ•°ï¼‰ã®é–¾å€¤ã¯ã©ã†è¨­å®šã™ã¹ãã‹ï¼Ÿ  
A: ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚„ã‚¿ã‚¹ã‚¯ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚ã¾ãšã¯ demo_numeric.py ã‚’ä½¿ç”¨ã—ã¦ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ãªã‚‹æ•°å€¤ã‚’æ¸¬å®šã—ã€é€šå¸¸æ™‚ã®å¹³å‡å€¤ã‹ã‚‰+2Ïƒï¼ˆæ¨™æº–åå·®ã®2å€ï¼‰ç¨‹åº¦ã‚’ç›®å®‰ã«è¨­å®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

#### Q: è¨ˆç®—è² è·ã¯é«˜ã„ã®ã‹ï¼Ÿ  
A: æ¥µã‚ã¦è»½é‡ã§ã™ã€‚å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰è‡ªä½“ã®è¨ˆç®—é‡ã«æ¯”ã¹ã‚Œã°ã€ONTOSã®æ§‹é€ è§£æã«å¿…è¦ãªè¨ˆç®—ãƒªã‚½ãƒ¼ã‚¹ã¯ç„¡è¦–ã§ãã‚‹ã»ã©å°ã•ãã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã«é©ã—ã¦ã„ã¾ã™ã€‚

## ã‚³ãƒ³ã‚¿ã‚¯ãƒˆ  
ã”èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯ã€ä»¥ä¸‹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚  
yubainu98@gmail.com
